openapi: 3.0.3
info:
  title: JollofAI Backend API
  version: 1.2.0
  description: >
    Backend API for **JollofAI** â€” AI-powered meal and vendor discovery platform.
    Includes authentication (JWT & Google OAuth) and vendor integration with Google Places API.

servers:
  - url: http://localhost:5000/api

tags:
  - name: Auth
    description: User authentication and profile management
  - name: Vendors
    description: Vendor management and Google Places integration

security:
  - BearerAuth: []
  - ApiKeyAuth: []

paths:

  ##############################
  # AUTH ROUTES
  ##############################

  /auth/register:
    post:
      summary: Register a new user
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - email
                - password
              properties:
                name:
                  type: string
                email:
                  type: string
                password:
                  type: string
      responses:
        "201":
          description: User registered successfully
        "400":
          description: Invalid input or user already exists

  /auth/login:
    post:
      summary: Log in and receive JWT
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                password:
                  type: string
      responses:
        "200":
          description: Login successful, returns JWT
        "401":
          description: Invalid credentials

  /auth/google:
    get:
      summary: Google OAuth login (redirect)
      tags: [Auth]
      description: Redirects user to Google for authentication.
      responses:
        "302":
          description: Redirect to Google Auth

  /auth/google/callback:
    get:
      summary: Google OAuth callback
      tags: [Auth]
      description: Handles redirect from Google and issues JWT.
      responses:
        "200":
          description: Google login success with JWT
        "400":
          description: Invalid or expired Google token

  /auth/forgot-password:
    post:
      summary: Request password reset email
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
      responses:
        "200":
          description: Reset link sent
        "404":
          description: Email not found

  /auth/reset-password:
    post:
      summary: Reset password using token
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
                - newPassword
              properties:
                token:
                  type: string
                newPassword:
                  type: string
      responses:
        "200":
          description: Password reset successful
        "400":
          description: Invalid or expired token

  /auth/profile:
    get:
      summary: Get logged-in user profile
      tags: [Auth]
      security:
        - BearerAuth: []
      responses:
        "200":
          description: User profile returned
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "401":
          description: Unauthorized

  ##############################
  # VENDOR ROUTES
  ##############################

  /vendors/sync:
    post:
      summary: Sync vendor data from Google Places API
      tags: [Vendors]
      security:
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - lat
                - lng
              properties:
                lat:
                  type: number
                  example: 6.5244
                lng:
                  type: number
                  example: 3.3792
      responses:
        "200":
          description: Vendor data synced successfully
        "400":
          description: Missing latitude or longitude
        "403":
          description: Invalid or missing API key
        "429":
          description: Too many requests
        "500":
          description: Error syncing vendors

  /vendors/nearby:
    get:
      summary: Get vendors near a location
      tags: [Vendors]
      parameters:
        - name: lat
          in: query
          required: true
          schema:
            type: number
          example: 6.5244
        - name: lng
          in: query
          required: true
          schema:
            type: number
          example: 3.3792
        - name: radius
          in: query
          required: false
          schema:
            type: number
            default: 5000
          example: 5000
      responses:
        "200":
          description: Nearby vendors returned
        "400":
          description: Missing coordinates
        "500":
          description: Error fetching vendors

  /vendors/{id}:
    get:
      summary: Get vendor by ID
      tags: [Vendors]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: 652f2c91e92c1fef12345678
      responses:
        "200":
          description: Vendor found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Vendor"
        "404":
          description: Vendor not found
        "500":
          description: Error fetching vendor

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    ApiKeyAuth:
      type: apiKey
      in: header
      name: x-api-key

  schemas:

    ##############################
    # USER MODEL
    ##############################
    User:
      type: object
      properties:
        _id:
          type: string
        name:
          type: string
        email:
          type: string
        password:
          type: string
          description: Hashed password
        provider:
          type: string
          enum: [local, google]
        googleId:
          type: string
          nullable: true
        avatar:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    ##############################
    # VENDOR MODEL
    ##############################
    Vendor:
      type: object
      properties:
        _id:
          type: string
        name:
          type: string
        placeId:
          type: string
        address:
          type: string
        location:
          type: object
          properties:
            type:
              type: string
              example: Point
            coordinates:
              type: array
              items:
                type: number
              example: [3.3792, 6.5244]
        rating:
          type: number
        userRatingsTotal:
          type: number
        image:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
